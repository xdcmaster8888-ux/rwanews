name: ğŸš€ RWA News Auto-Deploy to GitHub Pages

on:
  schedule:
    # æ¯æ—¥ 08:00 JST (UTC 23:00å‰æ—¥)
    - cron: '0 23 * * *'
    # æ¯æ—¥ 18:00 JST (UTC 09:00)
    - cron: '0 9 * * *'
  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ Python 3.11 ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ RWA ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”Ÿæˆ & HTML ä½œæˆ
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        run: |
          python main.py

      - name: ğŸ“ ç”Ÿæˆçµæœã‚’ç¢ºèª
        run: |
          if [ -f docs/index.html ]; then
            echo "âœ… HTML ãƒ•ã‚¡ã‚¤ãƒ«ç”ŸæˆæˆåŠŸ"
            ls -lh docs/index.html
          else
            echo "âŒ HTML ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            exit 1
          fi

      - name: ğŸ“¤ å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/
          git add output/
          git commit -m "ğŸš€ RWA News Auto-Update: $(date '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
          git push origin main

      - name: ğŸŒ GitHub Pages ã®ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: actions/upload-pages-artifact@v2
        with:
          path: 'docs'

      - name: âœ… GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤
        id: deployment
        uses: actions/deploy-pages@v2

  notify:
    needs: deploy
    runs-on: ubuntu-latest
    if: always()

    steps:
      - name: ğŸ“¢ å®Ÿè¡Œçµæœã‚’ãƒ­ã‚°å‡ºåŠ›
        run: |
          if [ "${{ needs.deploy.result }}" = "success" ]; then
            echo "âœ… RWA News è‡ªå‹•å…¬é–‹æˆåŠŸ"
            echo "ğŸ“¡ URL: https://github.com/${{ github.repository }}"
          else
            echo "âŒ RWA News è‡ªå‹•å…¬é–‹å¤±æ•—"
            echo "ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
          fi
